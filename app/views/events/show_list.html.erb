<%= link_to t(:back_to_event), event_path(@event), class: "btn btn-default"%>
<div id="participants">
  <table class="table table-striped">

    <thead>
      <tr>
        <td @click="orderByWhat('id')">#</td>
        <td @click="orderByWhat('profile.name')"><%= t(:name) %></td>
        <td @click="orderByWhat('profile.sex')"><%= t(:sex) %></td>
      </tr>
    </thead>

    <tbody >
      <tr v-for=" participant in participants | orderBy what order | filterBy searchText in fields">
        <td>{{ $index + 1}}</td>
        <td>{{ participant.profile.name }}</td>
        <td>{{ participant.profile.sex }}</td>
      </tr>
    </tbody>

  </table>
</div>
<script type="text/javascript">
  var participants_data = <%= sanitize @participants.to_json(include: { profile: { only: [:name,:sex] }}) %>;

  var participants = new Vue({
    el : '#participants',
    data : {
      order : 1,
      what : '',
      participants : participants_data,
      searchText : '',
      fields : ['profile.name','profile.sex']
    },
    created : function(){
      this.checkProfile();
    },
    methods : {
      orderByWhat : function(what){
        if (this.what == what) {
          this.order = this.order * -1;
        }
        else{
          this.order = 1;
          this.what = what;
        }

      },
      checkProfile : function(){
        for (var i = 0; i < this.participants.length; i++) {
          if ( !this.participants[i].profile ) {
            this.participants[i].profile = {
              name : '',
              sex : '',
            };
          }

          // 名字上馬賽克 ex: 王小明 => 王X明
          var nameArray = this.participants[i].profile.name.split("");
          switch(nameArray.length){
            case 2 :
              nameArray.splice(1, 1, "X");
              break;
            case 3 :
              nameArray.splice(1, 1, "X");
              break;
            case 4 :
              nameArray.splice(2, 1, "X");
              break;
            default :

          }
          this.participants[i].profile.name = nameArray.join("");
        }
      }
    }
  });
</script>
