<div class="pull-right">
	<%= link_to(t(:new_event), new_event_path, class: "btn btn-primary") if current_user.present? && current_user.is_manager? %>
</div>
<div id="events">

  <form class="form-horizontal" role="form">
    <div class="form-group">
      <label class="col-md-1  control-label">搜索 : </label>
      <div class="col-md-2">
        <input v-model="searchText" type="text" class="form-control" placeholder="活動名稱">
      </div>
    </div>
  </form>

	<table class="table table-hover" >
		<thead>
			<tr >
				<td @click="orderByWhat('id')">#</td>
				<td @click="orderByWhat('name')"><%= t(:event_name) %></td>
				<td @click="orderByWhat('sign_up_begin')"><%= t(:event_sign_up_begin) %></td>
				<td @click="orderByWhat('sign_up_end')"><%= t(:event_sign_up_end) %></td>
				<td @click="orderByWhat('start')"><%= t(:event_start) %></td>
				<td @click="orderByWhat('over')"><%= t(:event_over) %></td>
				<td @click="orderByWhat('participants_count')"><%= t(:event_participants_number) %></td>
			</tr>
		</thead>
		<!-- <tbody>
			<% i=0 %>
			<% @events.each do |event| %>
			<tr>
				<td> <%= i+=1 %> </td>
				<td> <%= link_to(event.name, event_path(event)) %> </td>
				<td> <%= event.sign_up_begin.to_s(:Ymd_HM) + " - " +event.sign_up_end.to_s(:Ymd_HM) %> </td>
				<td> <%= event.start.to_s(:Ymd_HM) + " - " +event.over.to_s(:Ymd_HM) %> </td>
				<td> 
					<%= event.participants_count %> 
					/ 
					<%= event.max_sign_up_number %>
				</td>
				<td>
					<% if current_user.present? && current_user.is_manager? %>
						<%= link_to(t(:edit), edit_event_path(event), class: "btn btn-sm btn-primary")%>
						<%= link_to(t(:delete), event_path(event),    class: "btn btn-sm btn-danger",
						method: :delete, data: { confirm: "Are you sure?" } )%>
					<% end %>
				</td>
				
			</tr>
			<% end %>
		</tbody> -->
		
		<!-- Vue events -->
		<tbody >
			<tr v-for=" event in events | orderBy what order | filterBy searchText in fields " onclick="window.document.location='/events/{{event.id}}';">
				<td>{{ $index + 1}}</td>
				<td>{{ event.name }}</td>
				<td>{{ event.sign_up_begin_format }}</td>
				<td>{{ event.sign_up_end_format }}</td>	
				<td>{{ event.start_format }}</td>
				<td>{{ event.over_format }}</td>
				<td>{{ event.participants_count }} / {{ event.max_sign_up_number }}</td>	
			</tr>
		</tbody>
	</table>

</div>
<script type="text/javascript">
	var events_data = <%= sanitize @events.to_json %>;
	var events = new Vue({
		el : '#events',
		data : {
			order : 1,
			what : '',
			events : events_data,
      	searchText : '',
      	fields : ['name']
		},
		created : function(){
			this.setTimeFormat();
		},
		methods : {
			orderByWhat : function(what){
		        if (this.what == what) {
		          this.order = this.order * -1;
		        }
		        else{
		          this.order = 1;
		          this.what = what;
		        }
          
      		},
      		setTimeFormat : function(){
      			for (var i = 0; i < this.events.length; i++) {
      				this.events[i].sign_up_begin_format = moment(this.events[i].sign_up_begin).format("YYYY年 M月D日 HH點mm分, dddd");
      				this.events[i].sign_up_end_format = moment(this.events[i].sign_up_end).format("YYYY年 M月D日 HH點mm分, dddd");
      				this.events[i].start_format = moment(this.events[i].start).format("YYYY年 M月D日 HH點mm分, dddd");
      				this.events[i].over_format = moment(this.events[i].over).format("YYYY年 M月D日 HH點mm分, dddd");
      			}
      		}
    	}

	});
</script>


